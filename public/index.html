<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>hello-wasm example</title>
  </head>
  <body>
    <script type="module">
      const worker = new Worker("worker.js", { type: "module" });

      let messageCounter = 0;
      const messagePromises = {};

      worker.onmessage = (event) => {
        const { messageId, success, result, error } = event.data;
        if (messageId in messagePromises) {
          const { resolve, reject } = messagePromises[messageId];
          if (success) {
            resolve(result);
          } else {
            reject(new Error(error));
          }
          delete messagePromises[messageId];
        }
      };

      worker.onerror = (error) => {
        console.error("Worker error:", error);
        alert("An error occurred in the web worker");
      };

      const callWorkerFunction = (functionName, ...args) => {
        const messageId = messageCounter++;
        return new Promise((resolve, reject) => {
          messagePromises[messageId] = { resolve, reject };
          worker.postMessage({ functionName, args, messageId });
        });
      };

      callWorkerFunction("count_etfs_per_exchange").then((data) => {
        console.log({ data });
      });

      // Call the function and log the result
      callWorkerFunction("get_etf_holder", "SPY")
        .then((url) =>
          console.log({
            etfHolder: url,
          })
        )
        .catch((error) => console.error(error));

      callWorkerFunction("get_etf_holder", "TESTING123")
        .then((url) =>
          console.log({
            etfHolder: url,
          })
        )
        .catch((error) => console.error(error));
    </script>
  </body>
</html>
