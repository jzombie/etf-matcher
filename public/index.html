<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />

    <meta name="html_build_time" content="<%= buildTime %>" />

    <title>ETF Matcher</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <!-- // Very simple no-cache mechanism. This may need to be improved if making the app a PWA. -->
    <script>
      (function () {
        const NO_CACHE_KEY = "no_cache";

        function getQueryParam(name) {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get(name);
        }

        function setQueryParam(name, value) {
          const url = new URL(window.location);
          url.searchParams.set(name, value);
          window.history.replaceState(null, "", url.toString());
        }

        function removeQueryParam(name) {
          const url = new URL(window.location);
          url.searchParams.delete(name);
          window.history.replaceState(null, "", url.toString());
        }

        const noCacheParam = getQueryParam(NO_CACHE_KEY);
        const now = Math.floor(Date.now() / 1000);

        if (noCacheParam) {
          const timestamp = parseInt(noCacheParam, 10);
          if (isNaN(timestamp) || now - timestamp > 10) {
            setQueryParam(NO_CACHE_KEY, now);
            window.location.reload(true); // Force reload with new parameter
          } else {
            removeQueryParam(NO_CACHE_KEY);
            console.debug("Loaded with skip-cache");
          }
        } else {
          setQueryParam(NO_CACHE_KEY, now);
          window.location.reload(true); // Force reload with new parameter
        }
      })();
    </script>

    <!-- Conditionally include Google Analytics script -->
    <script type="module">
      if (!import.meta.env.DEV) {
        if (import.meta.env.VITE_GOOGLE_ANALYTICS_ID) {
          const script = document.createElement("script");
          script.async = true;
          script.src = `https://www.googletagmanager.com/gtag/js?id=${
            import.meta.env.VITE_GOOGLE_ANALYTICS_ID
          }`;
          document.head.appendChild(script);

          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag("js", new Date());
          gtag("config", import.meta.env.VITE_GOOGLE_ANALYTICS_ID);

          window._gtag = gtag;
        } else {
          console.warn("`GOOGLE_ANALYTICS_ID` is not available");
        }
      }
    </script>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <meta
      name="description"
      content="Discover ETFs that most closely match your investment goals."
    />
    <meta
      name="keywords"
      content="ETF Matcher, exchange-traded funds, ETF search, virtual portfolio, fractional shares, investment goals, ETFs, portfolio customization, ETF comparison, online trading, investment management, ETF selection, investment tool, customize portfolio, find ETFs"
    />

    <style>
      /* styles.css or a similar global stylesheet */
      html,
      body,
      #app {
        height: 100%;
        margin: 0;
        padding: 0;
        background-color: #121212;
        overflow: hidden;
        /* box-sizing: border-box; */
      }

      /* Render noscript front and center */
      noscript.big {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        width: 100%;
        position: fixed;
        top: 0;
        left: 0;
        background: #121212;
        color: #ccc;
        font-weight: bold;
        font-size: 2em;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <noscript>
        Customize a virtual portfolio with potential fractional shares and find
        ETFs that closely match your investment goals.

        <div>
          Disclaimer: The information provided on this platform is for
          informational purposes only and does not constitute financial,
          investment, or other professional advice. You should not rely on this
          information to make any investment decisions. Always consult with a
          qualified financial advisor before making any investment decisions. We
          do not guarantee the accuracy, completeness, or timeliness of any
          information provided and shall not be held liable for any errors or
          omissions, or for any loss or damage incurred as a result of using
          this information.
        </div>
      </noscript>
    </div>
    <noscript class="big"
      >JavaScript must be enabled to use this application.</noscript
    >
    <script type="module" src="./src/main.tsx"></script>
  </body>
</html>
